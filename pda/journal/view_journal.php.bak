<?

  $hostname      = "proust";
  $journal_user  = "phpbb";
  $journal_pass  = "y&sw09lEt";
  $journal_db    = "wireless_jb";
  $max = 10;

  $journal_name  = $HTTP_POST_VARS["journal_name"];
  $journal_email = $HTTP_POST_VARS["journal_email"];
  $journal_msg   = $HTTP_POST_VARS["journal_msg"];
  $pg            = $HTTP_GET_VARS["pg"];

  $dbase_link = mysql_connect("$hostname", "$journal_user", "$journal_pass") or die("could not connect!");
  mysql_select_db($journal_db) or die("could not select database!");

  $cur_rows = 0;
  $max_rows = $max;
?>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
</head>
<body>
<table width="240" border="0" cellpadding="0" cellspacing="0">
  <tr>
    <td>
      <center>
        <font face="Arial" size="-1">
          <strong>Journal Messages</strong>
        </font>
      </center>
    </td>
  </tr>
</table>
<br>
<?

  if ($HTTP_GET_VARS["id"]=="1" && $journal_name != "" && $journal_msg != "") {

    $query = "INSERT INTO journal (journal_name, journal_email, journal_msg, journal_date, user_ip) VALUES ('$journal_name','$journal_email','$journal_msg','".date("Y-m-d h:i:s")."','".$HTTP_SERVER_VARS['REMOTE_ADDR']."')";
    $result = mysql_query($query) or die(mysql_error());
?>
  <font face="Arial" size="+1" color="navy">Thank you! <?=$journal_name?></font><br>
  <font face="Arial" size="+1" color="navy">Your message have been successfully added to the Journal.</font><br>
  Click <a href="/journal/view_journal.php?pg=1">here</a> to view the Journal.
<?
  die();
  } elseif ($journal_name == "" && $$HTTP_GET_VARS["id"]=="1") {
?>
  <font face="Arial" size="+2" color="red">Error!</font><br>
  <font face="Arial" size="+1" color="navy">You must enter a name.</font><br>
  Click <a href="/journal/journal.htm">here</a> to go back.
<?
  die();
  } elseif ($journal_msg == "" && $$HTTP_GET_VARS["id"]=="1") {
?>
  <font face="Arial" size="+2" color="red">Error!</font><br>
  <font face="Arial" size="+1" color="navy">You must enter a journal message.</font><br>
  Click <a href="/journal/journal.htm">here</a> to go back.
<?
  die();
  }

  $result = mysql_query("SELECT * FROM journal") or die(mysql_error());
  $num_rows = mysql_num_rows($result);

  if (!$pg) {
    $pg = 1;
  }
	
  if($pg!=1) {

    for($i=1;$i<$pg;$i++) {

      $cur_rows=$cur_rows+$max;
      $max_rows=$max_rows+$max;

    }
  }
?>
<table width="240" border="1" cellpadding="0" cellspacing="0">
<?	
  $query = "SELECT journal_name, journal_email, journal_date, journal_msg, journal_id FROM journal ORDER BY journal_date";

  $result = mysql_query($query) or die(mysql_error());

  $listed=0;

  while($line = mysql_fetch_array($result, MYSQL_ASSOC)) {	

    if($listed>=$cur_rows && $listed< $max_rows) {
?>
  <tr>
    <td>
<?
      foreach($line as $journal_rec[$count]) {

        if($count==0) { 
?>
      <font face="Arial" size="1" color="navy"><strong>Name:&nbsp; </strong></font>
      <font face="Arial" size="-4"><?=$journal_rec[$count]?></font>
      <br>
<?
        } 
        if($count==1 && $journal_rec[$count]!="") { 
?>
      <font face="Arial" size="1" color="navy"><strong>E-mail: </strong></font>
      <font face="Arial" size="-4"><a href="mailto:<?=$journal_rec[$count]?>"><?=$journal_rec[$count]?></a></font>
      <br>
<?
        }
        if($count==2) { 
?>
      <font face="Arial" size="1" color="navy"><strong>Date:&nbsp; &nbsp; </strong></font>
      <font face="Arial" size="-4"><?=$journal_rec[$count]?></font>
      <br>
<?
        }
        if($count==3) { 
?>
      <font face=arial size=1.5 color=navy><u>Message:</u></font><br>
      <font face="Arial" size="-4"><?=$journal_rec[$count]?></font>
<?
        }
        $count++;
      }
    }
    $listed++;
    $count=0;
?>
    </td>
  </tr>
<?}?>
</table>
<br>
<table align="left" border="0" width="240" cellspacing="0">
  <tr>
    <td align="left">
      <font face="Arial" size="2"><a href="journal.htm">Wireless Journal</a></font>
    </td>
    <td>
      <center>
        <font face="Arial" size=2">
<?	
  $pages = ceil($num_rows/$max);
	
  if($pg!=1) {
?>
        <a href="view_journal.php?id=0&pg=<?=($pg-1)?>">Previous</a>
<?
  }

  for($i=1;$i<=$pages;$i++) {

    if($pages>1) {
?>
        <a href="view_journal.php?id=0&pg=<?=$i?>"><u><?=$i?></u></a>
<?
    }
  }

  if($pg+1<=$pages) {
?>
        | <a href="view_journal.php?id=0&pg=<?=($pg+1)?>">Next</a>
<?}?>
        </font>
      </center>
    </td>
    <td align="right">
      <font face="Arial" size="2">Page <?=$pg?> of <?=(($pages==0)?1:$pages)?></font>
    </td>
  </tr>
</table>
</body>
</html>
<? mysql_close($dbase_link); ?>